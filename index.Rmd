---
title:  'The Miles Davis story told through Spotify data'
author: 'Willem Pleiter'
date:   'February--March 2020'
output: 
    flexdashboard::flex_dashboard:
        storyboard: true
        theme: sandstone
---

```{r setup}
# In order to use these packages, we need to install flexdashboard, plotly, and Cairo.
library(tidyverse)
library(plotly)
library(spotifyr)
library(Cairo)
library(gridExtra)
library(grid)
library(gtable)
library(compmus)
library(viridis)
source('spotify.R')

#Clustering
library(tidymodels)
library(protoclust)
library(ggdendro)
library(heatmaply)
library(kknn)
library(C50)


Miles40 <- 
    get_playlist_audio_features('Wpleiter', '1v8oL4Clr0LliAh6HNK4C2')
miles40ies_cut <- as.data.frame(Miles40[,c(6:16, 36)])
miles40ies_cut$Time_Period <- "1944-1950"

MilesE50 <- 
    get_playlist_audio_features('Wpleiter', '3lv2u17pbcXIoNZZtP8wZ5')
miles50ies_cut <- as.data.frame(MilesE50[,c(6:16, 36)])
miles50ies_cut$Time_Period <- "1951-1955"


MilesModal <-
    get_playlist_audio_features('Wpleiter', '72abFzvkLC2lAakjbvl0iC') 
MilesModal_cut <- as.data.frame(MilesModal[,c(6:16, 36)])
MilesModal_cut$Time_Period <- "1956-1962"

MilesHerbie <- 
    get_playlist_audio_features('Wpleiter', '6xkz0JZB6vwlUrLzELBmyl')
MilesHerbie_Cut <- as.data.frame(MilesHerbie[,c(6:16, 36)])
MilesHerbie_Cut$Time_Period <- "1963-1968"

MilesFusion <- 
    get_playlist_audio_features('Wpleiter', '2vDm2J2p2NlcuOK367TDXB')
MilesFusion_cut <- as.data.frame(MilesFusion[,c(6:16, 36)])
MilesFusion_cut$Time_Period <- "1969-1975"



MilesFinal <- 
    get_playlist_audio_features('Wpleiter', '00PARgmS4ypOOQcOopQBoK')
MilesFinal_cut <- as.data.frame(MilesFinal[,c(6:16, 36)])
MilesFinal_cut$Time_Period <- "1980 - 1992"


miles_long <- rbind(miles40ies_cut, miles50ies_cut, MilesModal_cut, MilesHerbie_Cut, MilesFusion_cut, MilesFinal_cut)
miles_wide <- miles_long %>%
  gather("danceability", "energy", "speechiness", "acousticness", "instrumentalness", "liveness", "valence", key = Feature, value = Parameter)


#For z-scores, filter on is.numeric and then use scale to get z-scores

```



### How predictable are Miles' Phases?
```{r}
Miles40_ML <- 
    get_playlist_audio_features('Wpleiter', '1v8oL4Clr0LliAh6HNK4C2') %>% 
    add_audio_analysis
MilesE50_ML <- 
    get_playlist_audio_features('Wpleiter', '3lv2u17pbcXIoNZZtP8wZ5') %>% 
    add_audio_analysis
MilesModal_ML <- 
    get_playlist_audio_features('Wpleiter', '72abFzvkLC2lAakjbvl0iC') %>% 
    add_audio_analysis
MilesHerbie_ML <- 
    get_playlist_audio_features('Wpleiter', '6xkz0JZB6vwlUrLzELBmyl') %>% 
    add_audio_analysis
MilesFusion_ML <- 
    get_playlist_audio_features('Wpleiter', '2vDm2J2p2NlcuOK367TDXB') %>% 
    add_audio_analysis
MilesFinal_ML <- 
    get_playlist_audio_features('Wpleiter', '00PARgmS4ypOOQcOopQBoK') %>% 
    add_audio_analysis


```


```{r}
Miles_all <- 
    Miles40_ML %>% mutate(playlist = "1945-50") %>% 
    bind_rows(
        MilesE50_ML %>% mutate(playlist = "1951-1955 "),
        MilesModal_ML %>% mutate(playlist = "1956-1962 "),
        MilesHerbie_ML %>% mutate(playlist = "1963-1968"),
        MilesFusion_ML %>% mutate(playlist = "1969-1975"),
        MilesFinal_ML %>% mutate(playlist = "1980-1991")) %>% 
    mutate(playlist = factor(playlist)) %>% 
    mutate(
        segments = 
            map2(segments, key, compmus_c_transpose)) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'mean', norm = 'manhattan'),
        timbre =
            map(
                segments,
                compmus_summarise, timbre,
                method = 'mean')) %>% 
    mutate(pitches = map(pitches, compmus_normalise, 'clr')) %>% 
    mutate_at(vars(pitches, timbre), map, bind_rows) %>% 
    unnest(cols = c(pitches, timbre))
```

```{r}
miles_class <- 
    recipe(playlist ~
               danceability +
               energy +
               loudness +
               speechiness +
               acousticness +
               instrumentalness +
               liveness +
               valence +
               tempo +
               duration +
               C + `C#|Db` + D + `D#|Eb` +
               E + `F` + `F#|Gb` + G +
               `G#|Ab` + A + `A#|Bb` + B +
               c01 + c02 + c03 + c04 + c05 + c06 +
               c07 + c08 + c09 + c10 + c11 + c12,
           data = Miles_all) %>% 
    step_center(all_predictors()) %>%
    step_scale(all_predictors()) %>%
    # step_range(all_predictors()) %>% 
    prep(Miles_all) %>% 
    juice
```


```{r}
Miles_CV <- miles_class %>% vfold_cv(10)
```


```{r}
set.seed(8)
miles_forest <- 
    rand_forest(mode = 'classification') %>% 
    set_engine('randomForest')
predict_forest <- function(split)
    fit(miles_forest,
        playlist  ~
               danceability +
               energy +
               loudness +
               speechiness +
               acousticness +
               acousticness * energy + 
               instrumentalness + 
               instrumentalness * energy +
               liveness +
               valence +
               duration 
                + `C#|Db`  +
               c01 + c02 + c03 + c04 + c05 + c06 +
               c07 + c08 + c09 + c10 + c11 + c12, data = analysis(split)) %>% 
    predict(assessment(split), type = 'class') %>%
    bind_cols(assessment(split))
```



```{r}
Miles_CV %>% 
    mutate(pred = map(splits, predict_forest)) %>% unnest(pred) %>% 
    conf_mat(truth = playlist, estimate = .pred_class) %>% 
    autoplot(type = 'heatmap')

```

***
In the beginning of my corpus I decided to split Miles' entire oeuvre into 6 distinct categories, based on the kind of music he was making at the time and the sidemen he surrounded him with (unfortunately very little sidewomen), but I never checked whether the division into these categories was justified. With the arrival of prediction techniques in this course, I now have the tools to check if an algorithm can tell these different time periods apart from each other as well as I can. After fiddling around with the KNN-means method and the random forest method, I saw that the random forest model performed slightly better overall, so that became the model of choice, the table on the left shows promising results.


First of all, there is a very clear distinction between early miles (1945-1962), transition miles (1963-1968) and late miles (1969-1991), as virtually none of the earlier songs get wrongfully assigned to later periods and vice versa. The transition period is called this because this is a period where Miles' started distancing himself from traditional harmony and general music theory that evolved from the swing, bop and modal age, as he himself was influenced by the free jazz movement from Ornette Coleman, Cecil Taylor and Eric Dolphy amongst others. The Fusion period is the most distinct of all periods in this table, with very high accuracy. The overall accuracy of the model was around 78%. 

The final question in answering whether my categories are true might be answered by performing cluster analysis, but the coming week I have still to do a lot of polishing and adding up to my portfolio (it's kind of a mess momentarily). Check out the next panel for my predictor analysis.



### Miles never showed a strong preferences for a certain key during his phases.

```{r}
miles_class %>% 
    fit(miles_forest, playlist ~ ., data = .) %>% 
    pluck('fit') %>% 
    randomForest::varImpPlot()
```

***
In this panel, the predictor duration comes out as the very clear winner of the model, which makes a lot of sense. Firstly, recording techniques in the 40ies and 50ies were generally still not perfect and people did not have the means and the tape to record long songs. This all got better during the 50ies however, in which Miles started recording his first 10 minute plus songs (the song All Blues from 1959 for instance is 11 minutes). So apart from Miles' his own preferences for duration, he was also very heavily limited by the techniques at the time. Still, the duration of his songs gradually increased and culminated during his fusion period (1969-1975), in which jams could last for over 30 minutes on some instances. 

The second easily interpretable predictor is acousticness, which already was apparent from my slopegraph, which showed a steady decline in acousticness over the years. Miles was a constant innovator, and the increasing popularity of electric guitars, piano's, basses and synthesizer in the mainstream also affected him. After 1969, most of his bandmates played electrical instruments. He himself however, never strayed far from his iconic muted trumpet sound.

At the bottom are tempo and the keys, which makes a lot of sense as well. Jazz-culture is jam-culture, each musician is brought up on jam-sessions, in which any musician could call on any tune in any key (and at any tempo). This is reflected in Miles' music as well, I could perhaps visualize the distribution of tempi and keys to further substantiate this point.

During the building of my model, I culled several predictors, of which almost all keys, the tempo and speechiness variable (since most of the music is instrumental). Furthermore, I incorporated interactions in my random forest model based on the slopegraph in the other panel. I created interactions between energy/acousticness and instrumentalness/energy. All modifications added about 7% to the prediction accuracy, and a random forest performed about 10% better on average than a Knn-means model.



### Update week 11
This week I did not have a lot of time to update my portfolio due to other courses, I have processed some data, which updated my plots and provided some new interesting things:

- There was a problem in de database in which a lot of the albums did not make my time period subsets (a lot of album release years were NAs for some reason, so I transformed the exact release data from days to years and used that instead), this yielded more data

- I have decided to omit the hiatus years of Miles (1975 - 1980), since Spotify only has 1 album of that period, which is a re-release of an earlier period

- I have filtered out a lot of compilation albums, remastered releases and later releases based on research to try to conclude original recordings exclusively

- I have standardized everything song and made a list of typical songs, I have not yet had the time to analyse these songs

- I have added and modified some interpretations to plots



### Comparing the structure of the most typical songs of each time period
Firstly I have made composite standardized z-scores based on acousticness, danceability, valence, energy and tempo. This allows me to filter out the most typical and atypical songs of each time period. The following is a list of typical songs (z < 0.01)

Most typical songs per time (based on tempo, valence, danceability, acousticness and energy)
40ies: 
-	Half Nelson

50ies:
-	Boplicity, Birth of the Cool

First Quintet
-	‘Round Midnight

Second Quintet:
-	Dolores	

Fusion:
-	Willie Nelson - Live at Fillmore East, New York, NY - June 20, 1970

Final years:
-	Freaky Deaky


***


```{r}
#filtering on numeric values

#40ies
miles40_filtered <- select_if(Miles40, is.numeric)
miles_composite40 <- miles40_filtered %>%
  scale() %>%
  as.data.frame() %>%
  mutate(compositescore = (danceability + acousticness + valence + energy + tempo) / 5)


#50ies
miles50_filtered <- select_if(MilesE50, is.numeric)
miles_composite50 <- miles50_filtered %>%
  scale() %>%
  as.data.frame() %>%
  mutate(compositescore = (danceability + acousticness + valence + energy + tempo) / 5)


#modal
milesmodal_filtered <- select_if(MilesModal, is.numeric)
miles_compositemodal <- milesmodal_filtered %>%
  scale() %>%
  as.data.frame() %>%
  mutate(compositescore = (danceability + acousticness + valence + energy + tempo) / 5)


#herbie
milesherbie_filter <- select_if(MilesHerbie, is.numeric)
milesherbie_composite <- milesherbie_filter %>%
  scale() %>%
  as.data.frame() %>%
  mutate(compositescore = (danceability + acousticness + valence + energy + tempo) / 5)



#Miles fusion
milesfusion_filter <- select_if(MilesFusion, is.numeric)
milesfusion_composite <- milesfusion_filter %>%
  scale() %>%
  as.data.frame() %>%
  mutate(compositescore = (danceability + acousticness + valence + energy + tempo) / 5)


#Miles Death
milesdeath_filter <- select_if(MilesFinal, is.numeric)
milesdeath_composite <- milesdeath_filter %>%
  scale() %>%
  as.data.frame() %>%
  mutate(compositescore = (danceability + acousticness + valence + energy + tempo) / 5)



```





### Miles Davis most popular track is very structured. {data-commentary-width=400}

```{r}
BiG <- 
    get_tidy_audio_analysis('0aWMVrwxPNYkKmFthzmpRi') %>% 
    compmus_align(bars, segments) %>% 
    select(bars) %>% unnest(bars) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'rms', norm = 'euclidean')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'mean'))
```


```{r}
BiG_structure <- matrix(0, 1, 7)
colnames(BiG_structure) <- c('Intro (piano, Bill Evans)', 
                             "Theme and solo Miles (trumpet)", 
                             "Solo Bill Evans (piano)", 
                             "Solo John Coltrane (Tenor Saxophone)", 
                             "2nd Solo Bill Evans",
                             "Solo Miles and final theme",
                             "Outro (piano, Bill Evans)")
BiG_structure[1,] <- c("0 - 20", "20 - 108", "108 - 146", "146 - 190", "190 - 212", "212 - 296", '296 - 337')
BiG_structure <- as.data.frame(t(BiG_structure))
colnames(BiG_structure) <- "Time Stamp"

```


```{r}
BiG_plot <- BiG %>% 
    compmus_self_similarity(timbre, 'cosine') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d)) + 
    geom_tile() +
    coord_fixed() +
    scale_fill_viridis_c(option = 'E', guide = 'none') +
    theme_classic() +
    labs(x = '', y = '')


  tt3 <- ttheme_minimal(
  core=list(bg_params = list(fill = viridis(7, alpha = 0.5) , col=NA),
            fg_params=list(fontface=1)),
  colhead=list(fg_params=list(col="navyblue", fontface=1L, cex = 1)),
  rowhead=list(fg_params=list(col="navyblue", fontface=2L, cex = 1)),
  base_size = 5)
  


BiG_Grob <- tableGrob(BiG_structure, theme=tt3)

grid.arrange(BiG_plot, BiG_Grob, widths = c(2,1,1))

```

***
Looking at the self-similarity matrix, the structure can very clearly be derived by the pattern. I've added timestamps in the table to show the individual sections of the song and they align perfectly. The setup is a quintet, with trumpet, piano and saxophone taking solo's and the rhythm section (piano, bass and drums) accompanying throughout the piece. The reason that this self-similarity matrix works so well is because only one instrument is solo-ing and the accompaniment stays the same. This makes the track very well structured and therefore easy to analyse with SS-matrices.

Have a listen to the song: <br><br>
<audio controls>
  <source src="Blue in Green by. Miles Davis.mp3" type="audio/mp3">
</audio>


### Comparing similar renditions of Summertime has only yielded inconclusive results so far {data-commentary-width=550}
```{r}
ST1959_audio_features <- get_track_audio_features('25H0Wd1ugPRXGM2LlpjVXM')
ST1991_AF <- get_track_audio_features('1c2Lw08YnZq71rUyrb2r8F')
ST1959 <- 
    get_tidy_audio_analysis('25H0Wd1ugPRXGM2LlpjVXM') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, timbre) %>%
    filter(start > 0, start < 72)
ST1991 <- 
    get_tidy_audio_analysis('1c2Lw08YnZq71rUyrb2r8F') %>% 
    select(segments) %>% unnest(segments) %>% 
    select(start, duration, timbre) %>%
    filter(start > 4, start < 72)
```





```{r}
compmus_long_distance(
    ST1959 %>% mutate(timbres = map(timbre, compmus_normalise, 'manhattan')),
    ST1991 %>% mutate(timbres = map(timbre, compmus_normalise, 'manhattan')),
    feature = timbres,
    method = 'euclidean') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d,
            main = "Miles Davis Summertime Comparison (1959 & 1991)")) + 
    geom_tile() +
    scale_fill_continuous(type = 'viridis', guide = 'none') +
    labs(x = 'Summertime 1959', y = 'Summertime 1991') +
    theme_minimal()


```


***
Using Dynamical Time-warping, I have compared two renditions of the popular song Summertime (Gershwin). One is recorded on the album Porgy & Bess by Miles in 1959 and arranged/produced by Gil Evans. The other is a 1991 (right before his death) rendition which uses the same arrangement and the same key. The differences between these tracks are that 1991 version is significantly faster (107 in 1959 and 132 in 1991). Other than that, the solo played by Miles is longer on the 1959 version and he is also the only soloist. In the 1991 version Miles playes a shorter solo and is taken over by a saxophone before finishing the theme himself at the end. I expected the chromagram to show a diagonal line during the theme that would fade when the solo's started, but so far have not found a way to visualize this. Perhaps micro-adjustments in key could work (although the audio features show that both are in the same key and I expect spotify to normalize this). Perhaps the fact that the audience is hearable has a great influence on the succes of DTW.


Check out the 1991 Summertime rendition (same recording as on the album)! <br> <br>
<audio controls>
  <source src="Summertime - Miles Davis with Quincy Jones.mp3" type="audio/mp3">
</audio>

Have a listen to the 1959 rendition: <br><br>
<audio controls>
  <source src="Miles Davis - Summertime.mp3" type="audio/mp3">
</audio>



### The Musically shapeshifting genius that is Miles Davis 
![Self-portrait by Miles Davis](milespainting5.jpg)



***

For my corpus I have decided to investigate the jazz trumpet player Miles Davis. Davis is known within the jazz and global community as a constant innovator and key figure of jazz music. His method for innovation was to constantly attract upcoming talents and stars within the upcoming current in jazz. He then instructed these youngsters with his own vision of jazz and this was reciprocated by the youngsters how provided him with their own new views. 

In my corpus I will try to analyse Davis’ music by answering some of the following questions:

-	How did Davis’ music change over time, what are the constants in his music and what are the variables?

-	How did Davis’ music reflect other albums of each specific time period that he was adapting to?


The following phases of Miles Davis’ oeuvre could be examined

-	Early bebop/Charlie Parker phase: 1945-1950

-	Hard Bop phase: 1950-1955

-	Miles Davis Cool Phase: 1955-1963

-	Miles Davis Acoustic Erratic: 1963-1968

-	Miles Davis electric/funk fusion: 1968-1975

-	Miles Davis Hiatus: 1975-1980

- Miles Davis final years: 1980-1992


### Miles transformations are visible in data from Spotify

```{r echo=FALSE, message=FALSE, warning=FALSE}
#Slopegraph is not in my gg-package for some reason, trying something else:
library("slopegraph")

#Creating a unique matrix to fulfill the conditions of ggplot
Miles_slope <- matrix(0, 7, 6)
colnames(Miles_slope) <- unique(miles_wide$Time_Period)
rownames(Miles_slope) <- names(MilesFinal_cut[,c(1,2,6,7,8,9,10)])


#40ies
Miles_slope[1,1] <- mean(miles40ies_cut[,1])
Miles_slope[2,1] <- mean(miles40ies_cut[,2])
Miles_slope[3,1] <- mean(miles40ies_cut[,6])
Miles_slope[4,1] <- mean(miles40ies_cut[,7])
Miles_slope[5,1] <- mean(miles40ies_cut[,8])
Miles_slope[6,1] <- mean(miles40ies_cut[,9])
Miles_slope[7,1] <- mean(miles40ies_cut[,10])



#second
Miles_slope[1,2] <- mean(miles50ies_cut[,1])
Miles_slope[2,2] <- mean(miles50ies_cut[,2])
Miles_slope[3,2] <- mean(miles50ies_cut[,6])
Miles_slope[4,2] <- mean(miles50ies_cut[,7])
Miles_slope[5,2] <- mean(miles50ies_cut[,8])
Miles_slope[6,2] <- mean(miles50ies_cut[,9])
Miles_slope[7,2] <- mean(miles50ies_cut[,10])


#Third
Miles_slope[1,3] <- mean(MilesModal_cut[,1])
Miles_slope[2,3] <- mean(MilesModal_cut[,2])
Miles_slope[3,3] <- mean(MilesModal_cut[,6])
Miles_slope[4,3] <- mean(MilesModal_cut[,7])
Miles_slope[5,3] <- mean(MilesModal_cut[,8])
Miles_slope[6,3] <- mean(MilesModal_cut[,9])
Miles_slope[7,3] <- mean(MilesModal_cut[,10])


#4
Miles_slope[1,4] <- mean(MilesHerbie_Cut[,1])
Miles_slope[2,4] <- mean(MilesHerbie_Cut[,2])
Miles_slope[3,4] <- mean(MilesHerbie_Cut[,6])
Miles_slope[4,4] <- mean(MilesHerbie_Cut[,7])
Miles_slope[5,4] <- mean(MilesHerbie_Cut[,8])
Miles_slope[6,4] <- mean(MilesHerbie_Cut[,9])
Miles_slope[7,4] <- mean(MilesHerbie_Cut[,10])

#5
Miles_slope[1,5] <- mean(MilesFusion_cut[,1])
Miles_slope[2,5] <- mean(MilesFusion_cut[,2])
Miles_slope[3,5] <- mean(MilesFusion_cut[,6])
Miles_slope[4,5] <- mean(MilesFusion_cut[,7])
Miles_slope[5,5] <- mean(MilesFusion_cut[,8])
Miles_slope[6,5] <- mean(MilesFusion_cut[,9])
Miles_slope[7,5] <- mean(MilesFusion_cut[,10])


#6
Miles_slope[1,6] <- mean(MilesFinal_cut[,1])
Miles_slope[2,6] <- mean(MilesFinal_cut[,2])
Miles_slope[3,6] <- mean(MilesFinal_cut[,6])
Miles_slope[4,6] <- mean(MilesFinal_cut[,7])
Miles_slope[5,6] <- mean(MilesFinal_cut[,8])
Miles_slope[6,6] <- mean(MilesFinal_cut[,9])
Miles_slope[7,6] <- mean(MilesFinal_cut[,10])


Miles_slope <- as.data.frame(Miles_slope)

data <- Miles_slope
xlabels <- names(data)

palette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00")
ggslopegraph(Miles_slope, offset.x = 1, main = "Mean Audio Features Of Miles Davis Per Period", xlim = c(-1,7), xlab = "Time Period", ylab = "Spotify Track Feature (0.00 - 1.00)",
  decimals = 2, col.lab = palette, col.lines = palette, col.num = palette, xlabels = c("'45-'50", "'51-'55", "'55-'63", "'63-'68", "'68-'75", "'80-'92"), labpos.right = 10, labpos.left = 0.7) + 
  theme(panel.grid =element_blank(), panel.background = element_blank())

```

***
When starting out his career, Miles started playing with the bebop-greats like Charlie Parker and Dizzie Gillespie, bebop is a jazz-genre that was (kind of) mainstream during the 1940ies and was characterized by high tempo's and a great focus on technical skill rather than expression. Miles never was a great technical player (compared to the big figures of the time) and was keen on going towards slower paced music in which he could show his sense of expression. As such he was one of the pivotal figures in the "Cool Jazz" movement that emerged in the early 50ies and resulted in slower paced music. This is the point in which the energy seemed to drop along with the valence. <br>

At the turn of the 60ies Miles wanted to get rid of conventional music harmonic theory and looked to experiment with more difficult time-signatures, free-jazz (in which the form was completely lost) and electrical instruments. This is best characterized by the sharp decrease in acousticness. Another trend seen in the chart is the increase in liveness of his oeuvre which is best explained by the fact that he wanted to create music on the spot as much as possible, with long improvised songs that did not follow any predetermined structure. 

During the 68 to 75 years his electrical playing was at its peak, and was more frantic and all over the place than the period before. This is seen by the increase in energy. 

In his last decade, Miles was a shapeshifter trying to cover popsongs, and ventured into hiphop(Doo Bop), while remaining true to experimental music.

<i> This was just an introduction, the text is not definite and I will have to look up more stuff </i>



### Miles in terms of Valence, Danceability and energy
```{r echo=FALSE, message=FALSE, warning=FALSE}

# miles_plot <- ggplot(miles_decades, aes(x = danceability, y = energy, col = Time_Period)) + 
#   geom_jitter()

ggplot(miles_long, aes(x = danceability, y = energy, col = valence)) + 
  geom_point(size = 1.5, alpha = 0.6) +
  facet_wrap(. ~ Time_Period) +
      geom_rug(size = 0.1)       # Add 'fringes' to show data distribution.

```

***
A general trend is clearly visible during Miles lifetime, in which a predominantly low energy and high valence repertoire (1944 - 1954) gradually diversified to cover the entire of the spectrum in 1969-1975, after which it remained mostly upbeat in his last years. The 1955-1962 (modal and first quintet years) are by far his most productive (292 datapoints) and are characterized by lots of low energy low valence ballad tunes and mid-danceability. The music in these years are what he is mostly remembered by now, although he heavily resisted to play this music in later years. 



